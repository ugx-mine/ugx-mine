<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UGX Mining Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .mining-card { background: linear-gradient(135deg, #0f172a 0%, #121a2e 100%); border: 1px solid #2a3d6a; border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .booster-card { background: linear-gradient(135deg, #1a2642 0%, #121a2e 100%); border: 1px solid #2a3d6a; border-radius: 16px; padding: 1.5rem; transition: all 0.3s ease; position: relative; overflow: hidden; }
        .booster-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, #00c16a, #00a870); }
        .booster-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0, 193, 106, 0.2); border-color: #00c16a; }
        .booster-duration { background: rgba(0, 193, 106, 0.15); color: #00c16a; border: 1px solid rgba(0, 193, 106, 0.3); padding: 0.1rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .countdown-display { font-family: monospace; font-size: 1.5rem; background: rgba(18, 26, 46, 0.7); padding: 0.5rem 1rem; border-radius: 0.5rem; min-width: 180px; text-align: center; }
        .status-pending { background-color: rgba(245, 158, 11, 0.15); color: #f59e0b; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; }
        .no-transactions { text-align: center; padding: 2rem; color: #64748b; }
        .currency-display { font-family: 'Courier New', monospace; font-weight: 600; }
        .edit-profile-btn { background: transparent; border: 1px solid #00c16a; color: #00c16a; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem; transition: all 0.2s; }
        .edit-profile-btn:hover { background: rgba(0, 193, 106, 0.1); }
        .action-buttons-section { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 2rem; }
        .action-button { flex: 1; min-width: 200px; }
        .auth-tab { padding: 0.5rem 1rem; cursor: pointer; border-radius: 0.5rem; width: 50%; text-align: center; }
        .auth-tab.active { background: rgba(0, 193, 106, 0.2); color: #00c16a; }
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #withdrawSuccessBanner { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-6">
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center space-x-3">
                <div class="bg-green-500 p-2 rounded-lg"><i class="fas fa-coins text-xl"></i></div>
                <h1 class="text-2xl font-bold">UGX<span class="text-white">Mine</span></h1>
            </div>
            <div class="flex gap-2">
                <button id="adminPanelBtn" class="px-3 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm hidden">Admin Panel</button>
                <button id="authToggle" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg">Sign Up / Login</button>
            </div>
        </header>

        <div id="authCard" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
            <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md">
                <div class="flex mb-4 bg-gray-700 rounded-lg p-1">
                    <div id="tabSignup" class="auth-tab">Sign Up</div>
                    <div id="tabLogin" class="auth-tab active">Login</div>
                </div>
                <form id="signupForm" class="hidden">
                    <div class="mb-4"><label class="block text-gray-300 mb-2">Username</label><input type="text" id="signupUsername" class="w-full bg-gray-700 rounded-lg px-4 py-2" required></div>
                    <div class="mb-4"><label class="block text-gray-300 mb-2">Email</label><input type="email" id="signupEmail" class="w-full bg-gray-700 rounded-lg px-4 py-2" required></div>
                    <div class="mb-4"><label class="block text-gray-300 mb-2">Password</label><input type="password" id="signupPassword" class="w-full bg-gray-700 rounded-lg px-4 py-2" required></div>
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 py-2 rounded-lg">Create Account</button>
                </form>
                <form id="loginForm">
                    <div class="mb-4"><label class="block text-gray-300 mb-2">Username</label><input type="text" id="loginUsername" class="w-full bg-gray-700 rounded-lg px-4 py-2" required></div>
                    <div class="mb-4"><label class="block text-gray-300 mb-2">Password</label><input type="password" id="loginPassword" class="w-full bg-gray-700 rounded-lg px-4 py-2" required></div>
                    <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 py-2 rounded-lg">Login</button>
                </form>
                <button id="closeAuth" class="w-full mt-4 bg-gray-700 hover:bg-gray-600 py-2 rounded-lg">Cancel</button>
            </div>
        </div>

        <main id="mainContent" class="hidden">
            <div class="mining-card mb-6">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 rounded-full bg-emerald-900/30 flex items-center justify-center"><i class="fas fa-user text-emerald-400"></i></div>
                        <div>
                            <div class="font-bold text-lg" id="profileUserName">---</div>
                            <div class="text-gray-400 text-sm" id="profileUserEmail">---</div>
                            <div class="text-gray-500 text-xs mt-1" id="profileUserId">---</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mining-card mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <p class="text-gray-400 text-sm">Current Balance</p>
                        <p class="text-3xl font-bold currency-display" id="balanceUGX">0 UGX</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm">Next Claim</p>
                        <p class="text-xl font-bold text-emerald-400" id="nextClaimAmount">10,000 UGX</p>
                        <p id="claimCountdown" class="text-gray-500 text-xs">Ready!</p>
                    </div>
                </div>
            </div>

            <div class="action-buttons-section">
                <div class="action-button">
                    <div class="mining-card">
                        <h2 class="text-lg font-bold mb-2">Mining Control</h2>
                        <div class="countdown-display" id="miningCountdown">Ready!</div>
                        <button onclick="mineReward()" id="miningBtn" class="w-full mt-4 bg-emerald-600 hover:bg-emerald-700 py-2 rounded-lg">Claim Rewards</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const url = 'https://rryvibgbpqyumfmgsiua.supabase.co';
        const key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyeXZpYmdicHF5dW1mbWdzaXVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4OTUwNTUsImV4cCI6MjA4MjQ3MTA1NX0.IMqZtMEiPyMwb8AW1gyFao9Yz2qWgMDibfbpVWOeG8o';
        const sb = supabase.createClient(url, key);

        let user = null;

        // UI Tabs
        tabSignup.onclick = () => { tabSignup.classList.add('active'); tabLogin.classList.remove('active'); signupForm.classList.remove('hidden'); loginForm.classList.add('hidden'); };
        tabLogin.onclick = () => { tabLogin.classList.add('active'); tabSignup.classList.remove('active'); loginForm.classList.remove('hidden'); signupForm.classList.add('hidden'); };
        authToggle.onclick = () => authCard.classList.remove('hidden');
        closeAuth.onclick = () => authCard.classList.add('hidden');

        // SIGNUP
        signupForm.onsubmit = async (e) => {
            e.preventDefault();
            const username = signupUsername.value;
            const email = signupEmail.value;
            const password = signupPassword.value;
            
            const newUser = { username, email, password, balance: 0, lastClaim: 0 };
            const { error } = await sb.from('ugx_users').upsert({ username, email, password, balance: 0, data: newUser });
            
            if (!error) { alert("Account Created! Please Login."); tabLogin.click(); }
        };

        // LOGIN
        loginForm.onsubmit = async (e) => {
            e.preventDefault();
            const { data, error } = await sb.from('ugx_users').select('*').eq('username', loginUsername.value).eq('password', loginPassword.value).single();
            
            if (data) {
                user = data.data || { balance: 0, lastClaim: 0, username: data.username };
                authCard.classList.add('hidden');
                mainContent.classList.remove('hidden');
                updateUI();
            } else {
                alert("Invalid Credentials");
            }
        };

        async function mineReward() {
            const now = Date.now();
            if (now - (user.lastClaim || 0) < 24 * 60 * 60 * 1000) {
                return alert("Mining in progress. Wait 24 hours.");
            }
            user.balance += 10000;
            user.lastClaim = now;
            updateUI();
            await sb.from('ugx_users').update({ balance: user.balance, data: user }).eq('username', user.username);
        }

        function updateUI() {
            document.getElementById('balanceUGX').innerText = user.balance.toLocaleString() + " UGX";
            document.getElementById('profileUserName').innerText = user.username;
            document.getElementById('profileUserEmail').innerText = user.email || "No Email";
            document.getElementById('profileUserId').innerText = "ID: UGX-" + user.username.toUpperCase();
        }
    </script>
</body>
</html>
