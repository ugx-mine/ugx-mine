<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UGXMine - Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-black text-white p-4">

    <div id="auth" class="max-w-sm mx-auto mt-20">
        <h1 class="text-2xl font-bold text-yellow-500 mb-4">UGXMine Login</h1>
        <input id="user" type="text" placeholder="Username" class="w-full p-2 bg-gray-900 border border-gray-700 rounded mb-4">
        <button onclick="login()" class="w-full bg-yellow-500 text-black font-bold py-2 rounded">Enter</button>
    </div>

    <div id="game" class="hidden max-w-sm mx-auto mt-10 text-center">
        <h2 id="name" class="text-gray-400"></h2>
        <div class="text-4xl font-bold text-yellow-500 my-6" id="bal">0 UGX</div>
        <button onclick="mine()" class="w-full bg-yellow-500 text-black font-black py-6 rounded-2xl text-2xl">CLAIM 10,000</button>
    </div>

    <script>
        const url = 'https://rryvibgbpqyumfmgsiua.supabase.co';
        const key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyeXZpYmdicHF5dW1mbWdzaXVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4OTUwNTUsImV4cCI6MjA4MjQ3MTA1NX0.IMqZtMEiPyMwb8AW1gyFao9Yz2qWgMDibfbpVWOeG8o';
        const sb = supabase.createClient(url, key);

        let currentUser = null;

        async function login() {
            const name = document.getElementById('user').value;
            const { data } = await sb.from('ugx_users').select('*').eq('username', name).single();
            
            if (data) { 
                currentUser = data.data; 
            } else {
                currentUser = { username: name, balance: 0 };
                await sb.from('ugx_users').upsert({ username: name, balance: 0, data: currentUser });
            }
            
            document.getElementById('auth').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            update();
        }

        async function mine() {
            currentUser.balance += 10000;
            update();
            await sb.from('ugx_users').update({ balance: currentUser.balance, data: currentUser }).eq('username', currentUser.username);
        }

        function update() {
            document.getElementById('bal').innerText = currentUser.balance.toLocaleString() + " UGX";
            document.getElementById('name').innerText = "Mining as: " + currentUser.username;
        }
    </script>
</body>
</html>
